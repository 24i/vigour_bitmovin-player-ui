<!DOCTYPE html>
<!--
  ~ Copyright (C) 2016, bitmovin GmbH, All Rights Reserved
  ~
  ~ Authors: Mario Guggenberger <mario.guggenberger@bitmovin.com>
  ~
  ~ This source code and its use and distribution, is subject to the terms
  ~ and conditions of the applicable license agreement.
  -->

<html>
<head>
    <meta charset="UTF-8"/>
    <title>Bitmovin Player UI Demo</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
    <link rel="stylesheet" href="css/demo.css">
    <link rel="stylesheet" href="css/bitmovin-playerui.css">
</head>
<body>

<div class="container">
    <div class="player-wrapper">
        <div class="player" id="player"></div>
    </div>

    <br>

    <div class="card">
        <h3 class="card-header">Playground</h3>

        <div class="card-block">
            <h4 class="card-title">Player Config</h4>

            <div class="form-group row">
                <label for="config-source" class="col-sm-4 form-control-label">Video Source</label>
                <div class="col-sm-4">
                    <select class="form-control" id="config-source"></select>
                </div>
                <span class="col-sm-4 form-text">The video source to load into the player.</span>
            </div>
        </div>

        <div class="card-block">
            <h4 class="card-title">Playback Control</h4>

            <div id="playback-controls"></div>

            <h5>Actions</h5>

            <button type="button" class="btn btn-primary btn-sm" id="btn-action-subtitle-add">Add subtitle</button>
            <button type="button" class="btn btn-primary btn-sm" id="btn-action-subtitle-remove">Remove subtitle</button>

            <h5>Output</h5>

            <div class="card card-block"><samp id="function-call-output"></samp></div>
        </div>

        <div class="card-block">
            <h4 class="card-title">Various</h4>

            <div class="form-group row">
                <label for="config-various-allevents" class="col-sm-4 form-control-label">Listen to all events</label>
                <div class="col-sm-4">
                    <input type="checkbox" id="config-various-allevents">
                </div>
                <span class="col-sm-4 form-text">Logs all fired events to the console</span>
            </div>
        </div>

    </div>
</div>

<script src="//bitmovin-a.akamaihd.net/bitmovin-player/stable/6/bitmovinplayer.min.js"></script>
<script src="js/bitmovin-playerui.js"></script>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
<script type="text/javascript">

    var player = bitmovin.player('player');

    var sources = {
        fullyFeatured: {
            dash: '//bitdash-a.akamaihd.net/content/sintel/sintel.mpd',
            hls: '//bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8',
            progressive: [
                {url: '//bitdash-a.akamaihd.net/content/sintel/Sintel.mp4', type: 'video/mp4'},
                {url: '//bitdash-a.akamaihd.net/content/sintel/Sintel.webm', type: 'video/webm'}
            ],
            poster: '//bitdash-a.akamaihd.net/content/sintel/poster.png',
            tracks: [{
                file: '//bitdash-a.akamaihd.net/content/sintel/sprite/sprite.vtt',
                kind: 'thumbnails'
            }]
        },
        basicDash: {
            dash: 'http://bitdash-a.akamaihd.net/content/sintel/sintel.mpd'
        },
        vr: {
            dash: 'https://bitmovin-a.akamaihd.net/content/playhouse-vr/mpds/105560.mpd',
            vr: {
                contentType: 'single'
            }
        },
        posterAndThumbnails: {
            dash: '//bitdash-a.akamaihd.net/content/MI201109210084_1/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd',
            hls: '//bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8',
            progressive: '//bitdash-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4',
            poster: '//bitdash-a.akamaihd.net/content/art-of-motion_drm/art-of-motion_poster.jpg',
            tracks: [{
                file: 'https://bitdash-a.akamaihd.net/content/MI201109210084_1/thumbnails/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.vtt',
                kind: 'thumbnails'
            }], userId: "demo_html5_vts", videoId: "art-of-motion"
        },
        live: {
            dash: 'http://bitcdn-kronehit-live.bitmovin.com/mpds/stream-full.php?streamkey=bitcodin&segmenthost=bitcdn-kronehit-live.bitmovin.com&liveoffset=20'
        },
        liveWithTimeshift: {
            dash: 'http://demo-dash-live.zahs.tv/hd/manifest.mpd?timeshift=100'
        }
    };

    var conf = {
        key: 'YOUR KEY HERE',
        source: sources.fullyFeatured,
        style: {
            ux: false
        },
        cast: {
            enable: true
        }
    };

    var uiConfig = {
        metadata: {
            title: "UI Demo Video Title"
        },
        recommendations: [
            {title: "Recommendation 1: The best video ever", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 10.4},
            {title: "Recommendation 2: The second best video", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 64},
            {title: "Recommendation 3: The third best video of all time", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 195},
            {title: "Recommendation 4: The fourth, you know what", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 15},
            {title: "Recommendation 5", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 174},
            {title: "Recommendation 6", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 26},
            {title: "Recommendation 7", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 87},
            {title: "Recommendation 8", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 54},
            {title: "Recommendation 9", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 22},
            {title: "Recommendation 10", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 44},
            {title: "Recommendation 11", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 435},
            {title: "Recommendation 12: Ain't no better video than this", url: "http://bitmovin.com", thumbnail: "http://placehold.it/300x300", duration: 34}
        ]
    };

    player.setup(conf).then(function () {
        // Add UI to loaded player
        bitmovin.playerui.UIManager.Factory.buildDefaultUI(player, uiConfig);
    }, function (errorEvent) {
        // Play setup failed, and there's no player UI yet to display the error in
        console.log(errorEvent);
    });

    $.each(sources, function (key, value) {
        $('#config-source').append($("<option></option>").attr("value", key).text(key));
    });
    $('#config-source').change(function () {
        player.unload();
        player.load(sources[$(this).val()]);
    });

    var printResult = function (result) {
        $("#function-call-output").html(JSON.stringify(result, null, 2));
    };

    // Collect all API methods of the player object
    var apiMethods = [];
    for (var member in player) {
        if (typeof player[member] == "function") {
            apiMethods.push(member);
        }
    }

    // Define custom parameters for testing API methods that take parameters
    var apiMethodParameters = {
        "setVolume": [0, 50, 100, function () { return player.getVolume() + 10; }],
        "seek": [0, function () { return player.getCurrentTime() + 60; }, function () { return player.getCurrentTime() - 60; }]
    };

    var addApiMethodButton = function (method, parameter) {
        var button = $('<button class="btn btn-primary btn-sm">' + method + '(' + (typeof parameter == 'undefined' ? '' : parameter) + ')' + '</button>');
        $('#playback-controls').append(button).append(" ");
        button.click(function () {
            var p = parameter;
            if (typeof parameter == "function") {
                // The parameter is a function, evaluate it first
                p = parameter();
            }
            printResult(player[method](p));
        });
    };

    // Create buttons for all API methods and method/parameter combinations
    $.each(apiMethods, function (key, method) {
        if (apiMethodParameters.hasOwnProperty(method)) {
            // We found custom parameter(s)
            var parameters = apiMethodParameters[method];
            if ($.isArray(parameters)) {
                // There are multiple parameters in an array, add a call for each parameter
                $.each(parameters, function (key, parameter) {
                    addApiMethodButton(method, parameter);
                });
            } else {
                // Just a single parameter, add the call
                addApiMethodButton(method, parameters);
            }
        } else {
            // No parameters defined, add a simple parameterless method call
            addApiMethodButton(method);
        }
    });

    $("#btn-action-subtitle-add").click(function () {
        printResult(player.addSubtitle("http://bitdash-a.akamaihd.net/content/sintel/subtitles/subtitles_en.vtt", "test", "subtitle", "ru", "Test Subtitle"));
    });
    $("#btn-action-subtitle-remove").click(function () {
        printResult(player.removeSubtitle("test"));
    });

    var allEventsListener = function (event) {
        console.log(event);
    };
    $('#config-various-allevents').change(function () {
        var checked = $(this).prop('checked');
        for (var event in bitmovin.player.EVENT) {
            if(checked) {
                player.addEventHandler(bitmovin.player.EVENT[event], allEventsListener);
            } else {
                player.removeEventHandler(bitmovin.player.EVENT[event], allEventsListener);
            }
        }
    });

</script>
</body>
</html>